<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year 8 Math Challenge: Factors, Indices & Factorising</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-y: auto;
        }
        .slide-content {
            min-height: 400px;
        }
        .game-container {
            min-height: 600px;
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .locked-level {
            filter: grayscale(1) blur(2px);
            cursor: not-allowed;
        }
        .correct {
            animation: correct-pulse 0.5s;
        }
        .incorrect {
            animation: incorrect-shake 0.5s;
        }
        @keyframes correct-pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(4, 120, 87, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(4, 120, 87, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(4, 120, 87, 0); }
        }
        @keyframes incorrect-shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">

    <div id="app-container" class="w-full h-full max-w-5xl mx-auto p-4 flex flex-col">

        <!-- Level Selection Screen -->
        <div id="level-selection" class="flex flex-col items-center justify-center h-full">
            <h1 class="text-5xl font-bold mb-2 text-cyan-400">Year 8 Math Challenge</h1>
            <p class="text-xl mb-12 text-gray-300">Integers & Expressions</p>
            <div id="levels-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8 w-full">
                <!-- Level cards will be inserted here by JavaScript -->
            </div>
        </div>
        
        <!-- Presentation & Game Screen -->
        <div id="main-view" class="hidden flex-col h-full w-full">
            
            <!-- Presentation Slides View -->
            <div id="presentation-view" class="w-full bg-gray-800 rounded-xl p-8 shadow-2xl flex-grow flex flex-col justify-between my-8">
                <div>
                    <h2 id="slide-topic" class="text-3xl font-bold text-cyan-400 mb-4"></h2>
                    <div id="slide-content" class="text-lg text-gray-200 space-y-4 slide-content">
                        <!-- Slide content will be inserted here -->
                    </div>
                </div>
                <div class="flex justify-between items-center mt-6">
                    <button id="prev-slide-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Previous</button>
                    <span id="slide-counter" class="text-gray-400"></span>
                    <div>
                        <button id="next-slide-btn" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg mr-2">Next</button>
                        <button id="start-game-btn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg">Start Quiz!</button>
                    </div>
                </div>
            </div>

            <!-- Game View -->
            <div id="game-view" class="hidden w-full bg-gray-800 rounded-xl p-8 shadow-2xl flex-grow flex flex-col game-container my-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="game-topic" class="text-2xl font-bold text-cyan-400"></h2>
                    <button id="back-to-levels-btn" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg">End Quiz</button>
                </div>
                
                <div class="w-full bg-gray-700 rounded-full h-4 mb-4">
                    <div id="progress-bar" class="bg-green-500 h-4 rounded-full" style="width: 0%"></div>
                </div>
                <div class="flex justify-center text-sm text-gray-400 mb-6">
                    <span id="progress-text">Question 1/50</span>
                </div>

                <div class="bg-gray-900 p-6 rounded-lg mb-6 text-center">
                    <p id="question-text" class="text-2xl font-semibold"></p>
                </div>

                <div id="options-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 flex-grow">
                    <!-- Option buttons will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Modal for results/messages -->
        <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
            <div class="bg-gray-800 rounded-xl p-8 shadow-2xl text-center max-w-md w-full">
                <h3 id="modal-title" class="text-3xl font-bold text-cyan-400 mb-4"></h3>
                <p id="modal-text" class="text-lg mb-6"></p>
                <button id="modal-btn" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 px-6 rounded-lg">Continue</button>
            </div>
        </div>

    </div>

    <script>
        // --- DATA ---
        const levelsData = [
            {
                title: "Factors, Multiples & Primes",
                description: "Learn to find prime factors, HCF, and LCM.",
                unlocked: true, // All levels are now unlocked
                slides: [
                    {
                        title: "Prime Factorisation",
                        content: `<p>Every integer greater than 1 is either a prime number or can be written as a product of prime numbers. We can use a <strong>factor tree</strong> to find these.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4 text-center">
                                      <p class="text-2xl">For example, the prime factors of 120 are:</p>
                                      <p class="text-3xl mt-2"><span class="text-cyan-400 font-bold">120</span> = 2 Ã— 2 Ã— 2 Ã— 3 Ã— 5 = <span class="text-green-400 font-bold">2Â³ Ã— 3 Ã— 5</span></p>
                                  </div>`
                    },
                    {
                        title: "Highest Common Factor (HCF)",
                        content: `<p>The HCF is the largest number that divides into two or more numbers.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4">
                                    <p class="text-xl">To find the HCF using prime factors, multiply the prime factors that are <strong>common</strong> to both numbers.</p>
                                    <p class="text-xl mt-2">120 = <span class="text-cyan-400">2 Ã— 2</span> Ã— 2 Ã— <span class="text-cyan-400">3</span> Ã— <span class="text-cyan-400">5</span></p>
                                    <p class="text-xl">60 = <span class="text-cyan-400">2 Ã— 2</span> Ã— <span class="text-cyan-400">3</span> Ã— <span class="text-cyan-400">5</span></p>
                                    <p class="text-xl mt-2">HCF = <span class="text-green-400 font-bold">2 Ã— 2 Ã— 3 Ã— 5 = 60</span></p>
                                  </div>`
                    },
                    {
                        title: "Lowest Common Multiple (LCM)",
                        content: `<p>The LCM is the smallest number that is a multiple of two or more numbers.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4">
                                    <p class="text-xl">To find the LCM, multiply the <strong>highest power</strong> of each prime factor that appears in either number.</p>
                                    <p class="text-xl mt-2">120 = <span class="text-cyan-400">2Â³</span> Ã— <span class="text-cyan-400">3Â¹</span> Ã— 5Â¹</p>
                                    <p class="text-xl">75 = 3Â¹ Ã— <span class="text-cyan-400">5Â²</span></p>
                                    <p class="text-xl mt-2">LCM = <span class="text-green-400 font-bold">2Â³ Ã— 3Â¹ Ã— 5Â² = 8 Ã— 3 Ã— 25 = 600</span></p>
                                  </div>`
                    },
                ],
                questions: [
                    // Moderate Difficulty (40 questions)
                    { q: "Which of these is a prime number?", o: ["1", "9", "15", "21", "23", "27"], a: "23" },
                    { q: "What are all the factors of 12?", o: ["1, 12", "1, 2, 3, 4, 12", "1, 2, 3, 4, 6, 12", "2, 3, 4, 6", "1, 2, 3, 4, 6", "2, 4, 6, 12"], a: "1, 2, 3, 4, 6, 12" },
                    { q: "What is the prime factorisation of 20?", o: ["2 Ã— 10", "4 Ã— 5", "2Â² Ã— 5", "2 Ã— 2 Ã— 5", "Both C and D", "20"], a: "Both C and D" },
                    { q: "What is the prime factorisation of 45?", o: ["5 Ã— 9", "3 Ã— 15", "3Â² Ã— 5", "3 Ã— 3 Ã— 5", "Both C and D", "4.5 Ã— 10"], a: "Both C and D" },
                    { q: "What is the highest common factor (HCF) of 12 and 18?", o: ["2", "3", "4", "6", "9", "12"], a: "6" },
                    { q: "What is the lowest common multiple (LCM) of 4 and 6?", o: ["2", "4", "6", "12", "24", "48"], a: "12" },
                    { q: "What is the HCF of 24 and 36?", o: ["4", "6", "8", "12", "24", "36"], a: "12" },
                    { q: "What is the LCM of 10 and 15?", o: ["5", "10", "15", "30", "60", "150"], a: "30" },
                    { q: "What is the prime factorisation of 100?", o: ["10Â²", "2 Ã— 50", "4 Ã— 25", "2Â² Ã— 5Â²", "2 Ã— 5 Ã— 10", "2 Ã— 2 Ã— 25"], a: "2Â² Ã— 5Â²" },
                    { q: "Which number is a multiple of 9?", o: ["91", "109", "119", "126", "137", "145"], a: "126" },
                    { q: "What is the HCF of 15 and 25?", o: ["1", "3", "5", "10", "15", "25"], a: "5" },
                    { q: "What is the LCM of 8 and 12?", o: ["4", "8", "12", "24", "48", "96"], a: "24" },
                    { q: "The number 60 is written as 2Â² Ã— 3 Ã— 5. What is 72?", o: ["2Â² Ã— 3Â³", "2Â³ Ã— 3Â²", "2 Ã— 6Â²", "8 Ã— 9", "2 Ã— 36", "2Â² Ã— 18"], a: "2Â³ Ã— 3Â²" },
                    { q: "What is the HCF of 50 and 75?", o: ["5", "10", "15", "25", "50", "75"], a: "25" },
                    { q: "What is the LCM of 9 and 12?", o: ["3", "18", "24", "36", "72", "108"], a: "36" },
                    { q: "What is the prime factorisation of 84?", o: ["2 Ã— 42", "4 Ã— 21", "2Â² Ã— 21", "2Â² Ã— 3 Ã— 7", "2 Ã— 2 Ã— 3 Ã— 7", "Both D and E"], a: "Both D and E" },
                    { q: "What is the HCF of 42 and 56?", o: ["2", "6", "7", "8", "14", "28"], a: "14" },
                    { q: "What is the LCM of 20 and 25?", o: ["5", "20", "50", "75", "100", "500"], a: "100" },
                    { q: "If a number's prime factors are 2Â³, 3 and 5Â², what is the number?", o: ["60", "120", "300", "600", "900", "1200"], a: "600" },
                    { q: "What is the HCF of 100 and 150?", o: ["10", "20", "25", "50", "75", "100"], a: "50" },
                    { q: "What is the LCM of 7 and 11?", o: ["1", "7", "11", "18", "77", "84"], a: "77" },
                    { q: "A number is 2Â² Ã— 3Â². Another is 2 Ã— 3Â³. What is their HCF?", o: ["2 Ã— 3Â²", "2Â² Ã— 3Â³", "2 Ã— 3", "2Â² Ã— 3Â²", "2Â³ Ã— 3âµ", "1"], a: "2 Ã— 3Â²" },
                    { q: "A number is 2Â² Ã— 3Â². Another is 2 Ã— 3Â³. What is their LCM?", o: ["2 Ã— 3Â²", "2Â² Ã— 3Â³", "2 Ã— 3", "2Â² Ã— 3Â²", "2Â³ Ã— 3âµ", "1"], a: "2Â² Ã— 3Â³" },
                    { q: "What is the HCF of 36, 54 and 72?", o: ["6", "9", "12", "18", "27", "36"], a: "18" },
                    { q: "What is the LCM of 6, 8 and 10?", o: ["2", "60", "80", "120", "240", "480"], a: "120" },
                    { q: "Two lights flash together. One flashes every 6 seconds, the other every 8 seconds. When will they next flash together?", o: ["12s", "14s", "18s", "24s", "36s", "48s"], a: "24s" },
                    { q: "What is the largest number that divides 60 and 75 exactly?", o: ["5", "10", "15", "25", "30", "60"], a: "15" },
                    { q: "Find the HCF of 2 Ã— 3Â² and 2Â² Ã— 3.", o: ["2 Ã— 3", "2Â² Ã— 3Â²", "2Â³ Ã— 3Â³", "1", "2", "3"], a: "2 Ã— 3" },
                    { q: "Find the LCM of 2 Ã— 5Â² and 2Â³ Ã— 5.", o: ["2 Ã— 5", "2Â³ Ã— 5Â²", "2â´ Ã— 5Â³", "10", "50", "200"], a: "2Â³ Ã— 5Â²" },
                    { q: "The product of two numbers is 120. If their HCF is 2, what is their LCM?", o: ["30", "60", "120", "240", "118", "Cannot be found"], a: "60" },
                    { q: "What is the prime factorisation of 180?", o: ["2Â² Ã— 3Â² Ã— 5", "2 Ã— 3Â² Ã— 10", "4 Ã— 9 Ã— 5", "2Â² Ã— 45", "18 Ã— 10", "2 Ã— 90"], a: "2Â² Ã— 3Â² Ã— 5" },
                    { q: "What is the HCF of 16 and 40?", o: ["2", "4", "8", "16", "40", "80"], a: "8" },
                    { q: "What is the LCM of 18 and 24?", o: ["6", "36", "48", "72", "96", "144"], a: "72" },
                    { q: "What is the only even prime number?", o: ["0", "1", "2", "4", "6", "None"], a: "2" },
                    { q: "Find the HCF of 48 and 72.", o: ["8", "12", "16", "24", "36", "48"], a: "24" },
                    { q: "Find the LCM of 5, 6 and 8.", o: ["30", "40", "60", "120", "240", "1"], a: "120" },
                    { q: "What is the prime factorisation of 330?", o: ["3 Ã— 11 Ã— 10", "2 Ã— 3 Ã— 5 Ã— 11", "33 Ã— 10", "2 Ã— 165", "5 Ã— 66", "3 Ã— 110"], a: "2 Ã— 3 Ã— 5 Ã— 11" },
                    { q: "Two numbers are 37 and 47. What is their HCF?", o: ["1", "37", "47", "37 Ã— 47", "0", "Cannot be found"], a: "1" },
                    { q: "What is the smallest number that is a multiple of both 12 and 15?", o: ["3", "30", "60", "120", "180", "1"], a: "60" },
                    { q: "A number's prime factors are 2 Ã— 7Â². What is the number?", o: ["28", "58", "98", "14", "196", "784"], a: "98" },
                    // Hard Difficulty (10 questions)
                    { q: "What is the smallest integer that is divisible by 2, 3, 4, 5 and 6?", o: ["30", "60", "90", "120", "180", "720"], a: "60" },
                    { q: "The HCF of two numbers is 6 and their LCM is 72. If one number is 18, what is the other?", o: ["12", "24", "36", "48", "6", "72"], a: "24" },
                    { q: "What is the smallest number you must multiply 40 by to make a perfect square?", o: ["2", "5", "10", "20", "40", "8"], a: "10" },
                    { q: "I am thinking of two prime numbers. Their sum is 20 and their product is 91. What are they?", o: ["3 and 17", "1 and 19", "5 and 15", "7 and 13", "9 and 11", "Cannot be found"], a: "7 and 13" },
                    { q: "Find the LCM of 2aÂ² and 3aÂ³.", o: ["a", "6a", "6aÂ²", "6aÂ³", "6aâµ", "aâµ"], a: "6aÂ³" },
                    { q: "Three bells ring at intervals of 4, 6 and 9 minutes. If they ring together at 8:00 am, when will they next ring together?", o: ["8:12 am", "8:18 am", "8:24 am", "8:36 am", "9:00 am", "9:12 am"], a: "8:36 am" },
                    { q: "A rectangular field of 60m by 84m is to be divided into identical square plots. What is the largest possible size of these plots?", o: ["6m x 6m", "10m x 10m", "12m x 12m", "14m x 14m", "20m x 20m", "4m x 4m"], a: "12m x 12m" },
                    { q: "What is the smallest 3-digit number that is a multiple of 6, 8 and 12?", o: ["108", "120", "132", "144", "100", "112"], a: "120" },
                    { q: "The product of the HCF and LCM of 18 and 24 is...", o: ["6", "72", "144", "432", "216", "1296"], a: "432" },
                    { q: "What is the smallest number which when divided by 15 and 18 leaves a remainder of 3?", o: ["33", "63", "93", "123", "183", "273"], a: "93" },
                ]
            },
            {
                title: "Indices",
                description: "Learn to use positive and zero indices in calculations.",
                unlocked: true, // All levels are now unlocked
                slides: [
                    {
                        title: "Understanding Indices",
                        content: `<p>An index, or power, tells you how many times to multiply a number by itself. The number being multiplied is the <strong>base</strong>.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4 text-center">
                                      <p class="text-2xl"><span class="text-cyan-400 text-4xl font-bold">5Â³</span> = 5 Ã— 5 Ã— 5 = <span class="text-green-400 font-bold">125</span></p>
                                      <p class="text-xl mt-2">Any number to the power of 1 is just itself (e.g. 5Â¹ = 5).</p>
                                  </div>`
                    },
                    {
                        title: "The Zero Index",
                        content: `<p>This is an important rule to remember: any number (except 0) raised to the power of zero is always <strong>1</strong>.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4 text-center">
                                      <p class="text-2xl"><span class="text-cyan-400 font-bold">8â° = 1</span></p>
                                      <p class="text-2xl"><span class="text-cyan-400 font-bold">25â° = 1</span></p>
                                      <p class="text-2xl"><span class="text-cyan-400 font-bold">xâ° = 1</span> (as long as x is not 0)</p>
                                  </div>`
                    },
                    {
                        title: "Index Laws: Multiplication & Division",
                        content: `<p>When numbers with the <strong>same base</strong> are multiplied or divided, we can use these simple rules:</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4 space-y-4">
                                      <p class="text-xl"><span class="font-bold text-cyan-400">Multiplication:</span> Add the indices. <br>
                                          <span class="text-2xl ml-4">3â´ Ã— 3Â² = 3â´âºÂ² = 3â¶</span></p>
                                      <p class="text-xl"><span class="font-bold text-cyan-400">Division:</span> Subtract the indices. <br>
                                          <span class="text-2xl ml-4">7â¸ Ã· 7Â³ = 7â¸â»Â³ = 7âµ</span></p>
                                  </div>`
                    },
                     {
                        title: "Index Laws: Power of a Power",
                        content: `<p>When you raise a power to another power, you <strong>multiply</strong> the indices.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4 text-center">
                                      <p class="text-2xl">(aáµ)â¿ = aáµË£â¿</p>
                                      <p class="text-3xl mt-2"><span class="text-cyan-400 font-bold">(4Â²)Â³</span> = 4Â²Ë£Â³ = <span class="text-green-400 font-bold">4â¶</span></p>
                                  </div>`
                    },
                ],
                questions: [
                    // Moderate Difficulty (40 questions)
                    { q: "What is 3Â³?", o: ["6", "9", "12", "27", "33", "81"], a: "27" },
                    { q: "What is 10â´?", o: ["40", "100", "1000", "10000", "100000", "14"], a: "10000" },
                    { q: "What is 99â°?", o: ["99", "0", "1", "9.9", "undefined", "-99"], a: "1" },
                    { q: "Simplify 2Â³ Ã— 2â´", o: ["2â·", "2Â¹Â²", "4â·", "4Â¹Â²", "2Â¹", "4Â¹"], a: "2â·" },
                    { q: "Simplify 5â¶ Ã· 5Â²", o: ["5â¸", "5â´", "5Â³", "1â´", "1â¸", "5Â¹Â²"], a: "5â´" },
                    { q: "What is (3Â²)Â²?", o: ["3â´", "3Â²", "3â¶", "9Â²", "6â´", "9â´"], a: "3â´" },
                    { q: "Simplify 10âµ Ã— 10", o: ["10âµ", "10â¶", "10â´", "100âµ", "100â¶", "11âµ"], a: "10â¶" },
                    { q: "Simplify 8â· Ã· 8â·", o: ["8Â¹â´", "8â´â¹", "1", "0", "8â°", "Both 1 and 8â°"], a: "Both 1 and 8â°" },
                    { q: "Which expression is equal to 625?", o: ["5Â³", "5â´", "5âµ", "25âµ", "125Â²", "5 Ã— 100"], a: "5â´" },
                    { q: "Simplify (10Â³)â´", o: ["10â·", "10Â¹Â²", "10â¸Â¹", "30â´", "40Â³", "10Â¹"], a: "10Â¹Â²" },
                    { q: "Find the missing power: 7â´ Ã— 7^? = 7â¹", o: ["4", "5", "6", "13", "36", "2.25"], a: "5" },
                    { q: "Find the missing power: 4^? Ã· 4Â² = 4â¶", o: ["3", "4", "8", "12", "4", "2"], a: "8" },
                    { q: "Simplify 3Â² Ã— 3â° Ã— 3â´", o: ["3â¶", "3â¸", "3â°", "1", "3Â²â´", "27â¶"], a: "3â¶" },
                    { q: "What is 2âµ?", o: ["10", "16", "25", "32", "64", "7"], a: "32" },
                    { q: "Simplify (xâµ)Â²", o: ["xâ·", "xÂ¹â°", "xÂ²âµ", "2xâµ", "5xÂ²", "xÂ³"], a: "xÂ¹â°" },
                    { q: "Simplify yÂ³ Ã— yâ·", o: ["yÂ¹â°", "yÂ²Â¹", "yâ´", "2yÂ¹â°", "yâ»â´", "10y"], a: "yÂ¹â°" },
                    { q: "Simplify zâ¸ Ã· z", o: ["zâ¸", "zâ·", "zâ¹", "8", "7", "1"], a: "zâ·" },
                    { q: "What is 4Â³?", o: ["12", "16", "32", "64", "81", "7"], a: "64" },
                    { q: "Simplify (aâ´)Â³", o: ["aâ·", "aÂ¹Â²", "aâ¶â´", "3aâ´", "4aÂ³", "aÂ¹"], a: "aÂ¹Â²" },
                    { q: "Simplify (2 Ã— 3)Â²", o: ["2Â² Ã— 3", "2 Ã— 3Â²", "2Â² Ã— 3Â²", "12", "36", "Both C and E"], a: "Both C and E" },
                    { q: "Simplify (5Â³ Ã— 5â´) Ã· 5Â²", o: ["5â¹", "5âµ", "5Â¹â´", "5Â²â´", "5Â¹", "5â°"], a: "5âµ" },
                    { q: "Which is larger: 2â¶ or 6Â²?", o: ["2â¶", "6Â²", "They are equal", "Cannot tell", "Both are 12", "Both are 8"], a: "2â¶" },
                    { q: "Simplify 9âµ / 3âµ", o: ["3âµ", "3Â¹â°", "3Â²Â·âµ", "6âµ", "3Â¹", "9â°"], a: "3âµ" },
                    { q: "What is the value of 2Â¹ + 2Â² + 2Â³?", o: ["2â¶", "12", "14", "16", "8", "6"], a: "14" },
                    { q: "If 10Ë£ = 100 000, what is x?", o: ["3", "4", "5", "6", "10", "100"], a: "5" },
                    { q: "Simplify (xÂ²yÂ³)â´", o: ["xâ¶yâ·", "xâ¸yÂ¹Â²", "xÂ²yÂ¹Â²", "xâ¸yÂ³", "2xÂ³yâ´", "4xÂ²yÂ³"], a: "xâ¸yÂ¹Â²" },
                    { q: "Write 8Â² as a power of 2.", o: ["2â´", "2âµ", "2â¶", "2â¸", "2Â¹â¶", "2Â³"], a: "2â¶" },
                    { q: "Write 27Â³ as a power of 3.", o: ["3â¶", "3â¹", "3Â¹Â²", "3Â²â·", "3Â³", "3â¸Â¹"], a: "3â¹" },
                    { q: "Simplify (4aâµ)Â². ", o: ["8aÂ¹â°", "16aÂ¹â°", "16aâ·", "8aâ·", "4aÂ¹â°", "4aâ·"], a: "16aÂ¹â°" },
                    { q: "What is the value of (1/2)Â³?", o: ["1/8", "1/6", "1/5", "3/2", "6", "8"], a: "1/8" },
                    { q: "Simplify (2a)Â³", o: ["2aÂ³", "6a", "6aÂ³", "8aÂ³", "8a", "2a"], a: "8aÂ³" },
                    { q: "Simplify 12xâµ / 3xÂ²", o: ["4xÂ³", "9xÂ³", "4xâ·", "9xâ·", "4xÂ²Â·âµ", "9xÂ²Â·âµ"], a: "4xÂ³" },
                    { q: "What is the value of 5Â² - 5Â¹?", o: ["5Â¹", "20", "5", "1", "0", "125"], a: "20" },
                    { q: "Find the missing power: (pÂ³) ^? = pÂ¹âµ", o: ["3", "5", "12", "18", "45", "1"], a: "5" },
                    { q: "Simplify 10â° + 10Â¹ + 10Â²", o: ["10Â³", "111", "123", "100", "110", "1"], a: "111" },
                    { q: "Simplify (aÂ²b)(abÂ²)", o: ["aÂ²bÂ²", "aÂ³bÂ³", "ab", "aÂ²bÂ³", "aÂ³bÂ²", "(ab)â¶"], a: "aÂ³bÂ³" },
                    { q: "What is 1,000,000,000 as a power of 10?", o: ["10â¶", "10â·", "10â¸", "10â¹", "10Â¹â°", "10Â¹Â²"], a: "10â¹" },
                    { q: "Simplify (6xâ¶) / (2xÂ²)", o: ["3xÂ³", "3xâ´", "4xÂ³", "4xâ´", "3xâ¸", "4xâ¸"], a: "3xâ´" },
                    { q: "Which of these is equal to 1?", o: ["xâµ/xâ´", "xâ°", "(xÂ³)â°", "All of the above", "None of the above", "xÂ¹"], a: "All of the above" },
                    { q: "Simplify (5x)â°", o: ["1", "5", "5x", "0", "x", "5â°x"], a: "1" },
                    // Hard Difficulty (10 questions)
                    { q: "Simplify (2xÂ²)Â³ Ã— (3x)Â²,", o: ["6xâ¸", "72xâ¸", "12xâ·", "36xâ¸", "72xâ·", "18xâ¸"], a: "72xâ¸" },
                    { q: "Write 4Â³ Ã— 8Â² as a power of 2.", o: ["2Â¹â°", "2Â¹Â¹", "2Â¹Â²", "2Â¹â¸", "2Â²â´", "2Â³â¶"], a: "2Â¹Â²" },
                    { q: "Solve for x: 3Ë£ = 81", o: ["2", "3", "4", "5", "9", "27"], a: "4" },
                    { q: "Simplify (10aâ¶) / (2aÂ²)", o: ["5aâ´", "5aÂ³", "8aâ´", "8aÂ³", "5aâ¸", "8aâ¸"], a: "5aâ´" },
                    { q: "What is the value of 2Â³ + 2Â³?", o: ["2â´", "2â¶", "4Â³", "4â¶", "2â¹", "8Â²"], a: "2â´" },
                    { q: "Solve for n: 2â¿ = 1/4", o: ["2", "-2", "1/2", "-1/2", "4", "-4"], a: "-2" },
                    { q: "Simplify (xÂ¹â° Ã· xâ´)Â³", o: ["xâ¹", "xÂ¹Â³", "xÂ¹â¸", "xÂ²Â²", "xÂ³â°", "xâ´Â²"], a: "xÂ¹â¸" },
                    { q: "If xÂ² = 100, what is xâ´?", o: ["200", "400", "1000", "10000", "100000", "100Â²"], a: "10000" },
                    { q: "Simplify (9aÂ²bâ¶) / (3abÂ²)", o: ["3abâ´", "3aÂ²bÂ³", "6abâ´", "6aÂ²bÂ³", "3aÂ³bâ¸", "6aÂ³bâ¸"], a: "3abâ´" },
                    { q: "What is half of 2Â¹â°?", o: ["1Â¹â°", "2âµ", "1âµ", "2â¹", "1â¹", "2â¸"], a: "2â¹" },
                ]
            },
            {
                title: "Factorising",
                description: "Learn to factorise expressions by finding the highest common factor.",
                unlocked: true, // All levels are now unlocked
                slides: [
                    {
                        title: "What is Factorising?",
                        content: `<p>Factorising is the <strong>reverse</strong> of expanding brackets. It means putting an expression back into brackets.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4 text-center">
                                      <p class="text-xl">Expanding: <span class="text-cyan-400">4(x + 3)</span> â” <span class="text-green-400">4x + 12</span></p>
                                      <p class="text-xl mt-2">Factorising: <span class="text-green-400">4x + 12</span> â” <span class="text-cyan-400">4(x + 3)</span></p>
                                  </div>`
                    },
                    {
                        title: "How to Factorise",
                        content: `<p>To factorise an expression, you find the <strong>Highest Common Factor (HCF)</strong> of all the terms.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4">
                                    <p class="text-xl">1. Find the HCF of the terms. For <span class="text-cyan-400">6x + 18</span>, the HCF of 6x and 18 is <span class="text-green-400">6</span>.</p>
                                    <p class="text-xl mt-2">2. Write the HCF outside a pair of brackets: <span class="text-green-400">6( ... )</span></p>
                                    <p class="text-xl mt-2">3. Divide each original term by the HCF and write the result inside the brackets: <br>6x Ã· 6 = x <br>18 Ã· 6 = 3</p>
                                    <p class="text-xl mt-2">So, the final answer is <span class="text-green-400 font-bold">6(x + 3)</span>.</p>
                                  </div>`
                    },
                    {
                        title: "Factorising with Variables",
                        content: `<p>The same method works when the HCF includes variables.</p>
                                  <div class="bg-gray-900 p-4 rounded-lg mt-4">
                                    <p class="text-xl">Factorise <span class="text-cyan-400">xÂ² - 5x</span></p>
                                    <p class="text-xl mt-2">The HCF of xÂ² and 5x is <span class="text-green-400">x</span>.</p>
                                    <p class="text-xl mt-2">Write x outside the brackets: <span class="text-green-400">x( ... )</span></p>
                                    <p class="text-xl mt-2">Divide the terms: xÂ² Ã· x = x, and -5x Ã· x = -5</p>
                                    <p class="text-xl mt-2">Answer: <span class="text-green-400 font-bold">x(x - 5)</span></p>
                                  </div>`
                    },
                ],
                questions: [
                    // Moderate Difficulty (40 questions)
                    { q: "Factorise 2x + 4", o: ["2(x+4)", "2(x+2)", "4(x+1)", "x(2+4)", "2(2x+2)", "2x(1+2)"], a: "2(x+2)" },
                    { q: "Factorise 3y - 9", o: ["3(y-3)", "3(y-6)", "9(y-1)", "y(3-9)", "3(y-9)", "9(y-3)"], a: "3(y-3)" },
                    { q: "Factorise 5a + 10", o: ["5(a+10)", "10(a+1)", "5(a+2)", "a(5+10)", "5(a+5)", "2(2.5a+5)"], a: "5(a+2)" },
                    { q: "Factorise 12 - 4p", o: ["4(3-p)", "4(8-p)", "12(1-4p)", "2(6-2p)", "4(3-4p)", "p(12-4)"], a: "4(3-p)" },
                    { q: "Factorise xÂ² + 3x", o: ["x(x+3)", "xÂ²(1+3)", "3(xÂ²+x)", "x(xÂ²+3)", "3x(x+1)", "x(3x)"], a: "x(x+3)" },
                    { q: "Factorise yÂ² - 7y", o: ["y(y-7)", "yÂ²(1-7)", "7(yÂ²-y)", "y(y-7y)", "7y(y-1)", "y(7-y)"], a: "y(y-7)" },
                    { q: "Factorise 6x + 18", o: ["3(2x+6)", "6(x+3)", "2(3x+9)", "9(x+2)", "6(x+18)", "x(6+18)"], a: "6(x+3)" },
                    { q: "Factorise 10 - 25m", o: ["10(1-2.5m)", "5(2-5m)", "5(5-2m)", "25(0.4-m)", "m(10-25)", "5(2-25m)"], a: "5(2-5m)" },
                    { q: "Factorise 4a + 8ab", o: ["4(a+2ab)", "4a(1+2b)", "a(4+8b)", "8a(0.5+b)", "4b(a+2a)", "2a(2+4b)"], a: "4a(1+2b)" },
                    { q: "Factorise 3pÂ² + 6p", o: ["3(pÂ²+2p)", "p(3p+6)", "3p(p+2)", "3pÂ²(1+2p)", "6p(0.5p+1)", "3p(p+6)"], a: "3p(p+2)" },
                    { q: "Factorise 9xy - 12x", o: ["3(3xy-4x)", "x(9y-12)", "3x(3y-4)", "9x(y-12)", "12x(0.75y-1)", "3y(3x-4)"], a: "3x(3y-4)" },
                    { q: "Factorise 15z - 10yz", o: ["5(3z-2yz)", "z(15-10y)", "5z(3-2y)", "10z(1.5-y)", "5y(3z-2z)", "yz(15-10)"], a: "5z(3-2y)" },
                    { q: "What is the HCF of 8y and 4yÂ²?", o: ["4", "y", "4y", "8y", "4yÂ²", "8yÂ²"], a: "4y" },
                    { q: "What is the HCF of 6x and 9xÂ²?", o: ["3", "x", "3x", "6x", "9xÂ²", "18xÂ²"], a: "3x" },
                    { q: "Factorise 7y - 7yÂ²", o: ["7(y-yÂ²)", "y(7-7y)", "7y(1-y)", "7yÂ²(1-y)", "7(y-y)", "7y(y-1)"], a: "7y(1-y)" },
                    { q: "Factorise 12pÂ² - 15p", o: ["3(4pÂ²-5p)", "p(12p-15)", "3p(4p-5)", "12p(p-1.25)", "15p(0.8p-1)", "3pÂ²(4-5p)"], a: "3p(4p-5)" },
                    { q: "Factorise 2x + 4y + 6z", o: ["2(x+2y+3z)", "2(x+y+z)", "xyz(2+4+6)", "6(x+y+z)", "2(x+2y+3)", "3(x+y+z)"], a: "2(x+2y+3z)" },
                    { q: "Factorise 5xÂ² + 10x + 15", o: ["5(xÂ²+2x+3)", "5x(x+2+3)", "5(xÂ²+10x+15)", "x(5x+10+15)", "15(xÂ²+x+1)", "5(xÂ²+2x+15)"], a: "5(xÂ²+2x+3)" },
                    { q: "Factorise 9y - yÂ² - xy", o: ["y(9-y-x)", "9(y-yÂ²-xy)", "y(9-yÂ²-x)", "x(9y-yÂ²-y)", "y(9-xy)", "y(9-1-x)"], a: "y(9-y-x)" },
                    { q: "Factorise 14ab + 21a", o: ["7(2ab+3a)", "a(14b+21)", "7a(2b+3)", "14a(b+1.5)", "21a(2/3b+1)", "7b(2a+3)"], a: "7a(2b+3)" },
                    { q: "Factorise 18xÂ²y - 6xyÂ²", o: ["6(3xÂ²y-xyÂ²)", "xy(18x-6y)", "6xy(3x-y)", "6xÂ²yÂ²(3-1)", "3xy(6x-2y)", "6y(3xÂ²-xy)"], a: "6xy(3x-y)" },
                    { q: "Factorise p + pÂ² + pÂ³", o: ["p(1+p+pÂ²)", "p(p+pÂ²)", "pÂ²(1+p)", "pÂ³(pâ»Â²+pâ»Â¹+1)", "3p(1+p+pÂ²)", "p(3)"], a: "p(1+p+pÂ²)" },
                    { q: "Factorise 8aÂ³ - 4aÂ²", o: ["4a(2aÂ²-a)", "4aÂ²(2a-1)", "aÂ²(8a-4)", "8aÂ²(a-0.5)", "4aÂ³(2-aâ»Â¹)", "2aÂ²(4a-2)"], a: "4aÂ²(2a-1)" },
                    { q: "Which expression is not a factor of 12xÂ²y?", o: ["3x", "4y", "6xy", "12xÂ²", "xyÂ²", "2x"], a: "xyÂ²" },
                    { q: "Factorise 16mÂ²n - 24mnÂ²", o: ["8mn(2m-3n)", "8(2mÂ²n-3mnÂ²)", "mn(16m-24n)", "8mÂ²nÂ²(2-3)", "4mn(4m-6n)", "8n(2mÂ²-3mn)"], a: "8mn(2m-3n)" },
                    { q: "Factorise fully: 2Ï€rÂ² + 2Ï€rh", o: ["2Ï€(rÂ²+rh)", "2r(Ï€r+Ï€h)", "2Ï€r(r+h)", "Ï€r(2r+2h)", "2(Ï€rÂ²+Ï€rh)", "r(2Ï€r+2Ï€h)"], a: "2Ï€r(r+h)" },
                    { q: "Factorise 100 - 20x", o: ["10(10-2x)", "2(50-10x)", "20(5-x)", "5(20-4x)", "100(1-0.2x)", "4(25-5x)"], a: "20(5-x)" },
                    { q: "Factorise x(a+b) + y(a+b)", o: ["(x+y)(a+b)", "xy(a+b)", "(x+a)(y+b)", "a(x+y)+b(x+y)", "ab(x+y)", "xy(2a+2b)"], a: "(x+y)(a+b)" },
                    { q: "Factorise 3a(x-1) - 2(x-1)", o: ["(3a-2)(x-1)", "3a-2(x-1)", "(3a-2x)+2", "x-1(3a-2)", "6a(x-1)", "-6a(x-1)"], a: "(3a-2)(x-1)" },
                    { q: "Factorise 9xÂ²y + 6xyÂ² - 3xy", o: ["3(3xÂ²y...)", "xy(9x+6y-3)", "3xy(3x+2y-1)", "3x(3xy...)", "3y(3xÂ²+...)", "3xy(3x+2y)"], a: "3xy(3x+2y-1)" },
                    { q: "Factorise 20ab - 15a", o: ["5(4ab-3a)", "a(20b-15)", "5a(4b-3)", "10a(2b-1.5)", "5b(4a-3)", "15a(4/3b-1)"], a: "5a(4b-3)" },
                    { q: "Factorise 7p - 21q", o: ["7(p-3q)", "7(p-21q)", "21(p/3-q)", "p(7-21q)", "q(7p-21)", "7p(1-3q)"], a: "7(p-3q)" },
                    { q: "Factorise mÂ² + m", o: ["m(m+1)", "mÂ²(1+mâ»Â¹)", "2m(m)", "m(m)", "2mÂ²", "m+mÂ²"], a: "m(m+1)" },
                    { q: "Factorise 18 - 3y", o: ["3(6-y)", "18(1-y/6)", "y(18-3)", "3(6-3y)", "9(2-y/3)", "6(3-y/2)"], a: "3(6-y)" },
                    { q: "Factorise 5xÂ² - 10x", o: ["5(xÂ²-2x)", "x(5x-10)", "5x(x-2)", "10x(0.5x-1)", "5xÂ²(1-2/x)", "2x(2.5x-5)"], a: "5x(x-2)" },
                    { q: "Factorise 6ab + 9bc", o: ["3(2ab+3bc)", "b(6a+9c)", "3b(2a+3c)", "3a(2b+3c)", "3c(2ab+3b)", "abc(6+9)"], a: "3b(2a+3c)" },
                    { q: "Factorise 4x + 8y", o: ["4(x+2y)", "2(2x+4y)", "8(x/2+y)", "x(4+8y)", "y(4x+8)", "4(x+8y)"], a: "4(x+2y)" },
                    { q: "Factorise 12xÂ² - 9x", o: ["3(4xÂ²-3x)", "x(12x-9)", "3x(4x-3)", "9x(4/3x-1)", "12x(x-3/4)", "3xÂ²(4-3/x)"], a: "3x(4x-3)" },
                    { q: "Factorise 25yÂ² + 15y", o: ["5(5yÂ²+3y)", "y(25y+15)", "5y(5y+3)", "15y(5/3y+1)", "25y(y+3/5)", "5yÂ²(5+3/y)"], a: "5y(5y+3)" },
                    { q: "Factorise 8xÂ²y - 4xy", o: ["4(2xÂ²y-xy)", "xy(8x-4)", "4xy(2x-1)", "4x(2xy-y)", "4y(2xÂ²-x)", "8xy(x-0.5)"], a: "4xy(2x-1)" },
                    // Hard Difficulty (10 questions)
                    { q: "Factorise 5(x+2) + 3x(x+2)", o: ["(5+3x)(x+2)", "8x(x+2)", "15x(x+2)", "5+3x(x+2)", "(5x+10)(3xÂ²+6x)", "3x+5(x+2)"], a: "(5+3x)(x+2)" },
                    { q: "Expand and then factorise fully: 3(2x+4) + 2(x+1)", o: ["8(x+2)", "2(4x+7)", "8x+14", "4(2x+3.5)", "2(4x+14)", "Cannot be factorised"], a: "2(4x+7)" },
                    { q: "Factorise aÂ²b + abÂ² + aÂ²bÂ²", o: ["ab(a+b+ab)", "aÂ²bÂ²(aâ»Â¹+bâ»Â¹+1)", "a(ab+bÂ²+abÂ²)", "b(aÂ²+ab+aÂ²b)", "ab(a+b)", "ab(aÂ²+bÂ²+ab)"], a: "ab(a+b+ab)" },
                    { q: "The area of a rectangle is 6xÂ²+9x. Which could be its dimensions?", o: ["3 and 2xÂ²+3x", "x and 6x+9", "3x and 2x+3", "All of the above", "None of the above", "6x and x+1.5"], a: "All of the above" },
                    { q: "Factorise 4m(p+q) - 6n(p+q)", o: ["2(p+q)(2m-3n)", "10mn(p+q)", "(4m-6n)(p+q)Â²", "(p+q)(4m-6n)", "Both A and D", "24mn(p+q)"], a: "Both A and D" },
                    { q: "Expand and factorise: 8(x+2) - 2(x+4)", o: ["6(x+2)", "6x+8", "2(3x+4)", "4(1.5x+2)", "6x+12", "6(x+1.33)"], a: "2(3x+4)" },
                    { q: "Factorise -5x - 20", o: ["-5(x+4)", "5(-x-4)", "-5(x-4)", "Both A and B", "5(x-4)", "-5(-x-4)"], a: "Both A and B" },
                    { q: "Factorise xÂ³yÂ² - xÂ²yÂ³ + xÂ²yÂ²", o: ["xÂ²yÂ²(x-y+1)", "xy(xÂ²y-xyÂ²+xy)", "xÂ²(xyÂ²-yÂ³+yÂ²)", "yÂ²(xÂ³-xÂ²y+xÂ²)", "xÂ²yÂ²(x-y)", "xÂ²yÂ²(x+y+1)"], a: "xÂ²yÂ²(x-y+1)" },
                    { q: "The surface area of a cylinder is 2Ï€rÂ² + 2Ï€rh. What is this in factorised form?", o: ["2Ï€(rÂ²+rh)", "2r(Ï€r+Ï€h)", "2Ï€r(r+h)", "Ï€r(2r+2h)", "2(Ï€rÂ²+Ï€rh)", "r(2Ï€r+2Ï€h)"], a: "2Ï€r(r+h)" },
                    { q: "Expand and factorise: 2x(x+y) + 3y(x+y)", o: ["(2x+3y)(x+y)", "5xy(x+y)", "6xy(x+y)", "(2x+y)(x+3y)", "(2x+3y)(x+y)Â²", "2xÂ²+5xy+3yÂ²"], a: "(2x+3y)(x+y)" },
                ]
            }
        ];

        // --- DOM ELEMENTS ---
        const levelSelectionScreen = document.getElementById('level-selection');
        const levelsGrid = document.getElementById('levels-grid');
        const mainView = document.getElementById('main-view');
        
        const presentationView = document.getElementById('presentation-view');
        const slideTopic = document.getElementById('slide-topic');
        const slideContent = document.getElementById('slide-content');
        const prevSlideBtn = document.getElementById('prev-slide-btn');
        const nextSlideBtn = document.getElementById('next-slide-btn');
        const slideCounter = document.getElementById('slide-counter');
        const startGameBtn = document.getElementById('start-game-btn');

        const gameView = document.getElementById('game-view');
        const gameTopic = document.getElementById('game-topic');
        const backToLevelsBtn = document.getElementById('back-to-levels-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const questionText = document.getElementById('question-text');
        const optionsGrid = document.getElementById('options-grid');

        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const modalBtn = document.getElementById('modal-btn');

        // --- GAME STATE ---
        let currentLevelIndex = 0;
        let currentSlideIndex = 0;
        let currentQuestionIndex = 0;

        // --- FUNCTIONS ---

        function init() {
            renderLevelCards();
            backToLevelsBtn.addEventListener('click', showLevelSelection);
        }

        function renderLevelCards() {
            levelsGrid.innerHTML = '';
            levelsData.forEach((level, index) => {
                // All levels are unlocked, so isLocked is always false
                const isLocked = false; 
                const card = document.createElement('div');
                card.className = `bg-gray-800 p-6 rounded-xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-center cursor-pointer`;
                card.innerHTML = `
                    <div class="text-5xl mb-4">${['ğŸŒ³', 'ğŸ”¢', 'ğŸ”§'][index]}</div>
                    <h2 class="text-2xl font-bold text-cyan-400 mb-2">${level.title}</h2>
                    <p class="text-gray-400">${level.description}</p>
                `;
                card.addEventListener('click', () => startLevel(index));
                levelsGrid.appendChild(card);
            });
        }

        function startLevel(index) {
            currentLevelIndex = index;
            currentSlideIndex = 0;
            levelSelectionScreen.classList.add('hidden');
            mainView.classList.remove('hidden');
            mainView.classList.add('flex');
            gameView.classList.add('hidden');
            presentationView.classList.remove('hidden');
            
            showSlide();

            prevSlideBtn.addEventListener('click', () => navigateSlide(-1));
            nextSlideBtn.addEventListener('click', () => navigateSlide(1));
            startGameBtn.onclick = () => {
                presentationView.classList.add('hidden');
                gameView.classList.remove('hidden');
                startGame();
            };
        }

        function showSlide() {
            const level = levelsData[currentLevelIndex];
            const slide = level.slides[currentSlideIndex];
            slideTopic.textContent = level.title;
            slideContent.innerHTML = `
                <h3 class="text-2xl font-semibold mb-4">${slide.title}</h3>
                ${slide.content}
            `;
            slideCounter.textContent = `Slide ${currentSlideIndex + 1} / ${level.slides.length}`;
            prevSlideBtn.disabled = currentSlideIndex === 0;
            prevSlideBtn.classList.toggle('opacity-50', prevSlideBtn.disabled);
            nextSlideBtn.style.display = currentSlideIndex === level.slides.length - 1 ? 'none' : 'inline-block';
            startGameBtn.style.display = currentSlideIndex === level.slides.length - 1 ? 'inline-block' : 'none';
        }

        function navigateSlide(direction) {
            currentSlideIndex += direction;
            showSlide();
        }

        function startGame() {
            const level = levelsData[currentLevelIndex];
            gameTopic.textContent = `${level.title} Quiz`;
            currentQuestionIndex = 0;
            displayQuestion();
            updateProgress();
        }

        function displayQuestion() {
            let question = levelsData[currentLevelIndex].questions[currentQuestionIndex];

            if (!question) {
                levelComplete();
                return;
            }

            questionText.innerHTML = question.q;
            optionsGrid.innerHTML = '';
            question.o.forEach(optionText => {
                const button = document.createElement('button');
                button.className = 'option-btn bg-gray-700 hover:bg-cyan-700 text-white font-semibold py-4 px-2 rounded-lg text-lg';
                button.innerHTML = optionText;
                button.onclick = () => checkAnswer(button, optionText, question.a);
                optionsGrid.appendChild(button);
            });
            updateProgress();
        }

        function checkAnswer(button, selectedAnswer, correctAnswer) {
            Array.from(optionsGrid.children).forEach(btn => btn.disabled = true);

            if (selectedAnswer === correctAnswer) {
                button.classList.add('bg-green-600', 'correct');
                setTimeout(nextQuestion, 1000);
            } else {
                button.classList.add('bg-red-600', 'incorrect');
                // The correct answer is no longer highlighted green
                setTimeout(nextQuestion, 2000);
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            const totalQuestions = levelsData[currentLevelIndex].questions.length;

            if (currentQuestionIndex >= totalQuestions) {
                levelComplete();
            } else {
                displayQuestion();
            }
        }
        
        function levelComplete() {
            const nextLevelIndex = currentLevelIndex + 1;
            if (nextLevelIndex < levelsData.length) {
                // No need to unlock, just show message
                showModal("Quiz Complete!", `You've finished this topic. Feel free to try another!`, showLevelSelection);
            } else {
                showModal("Congratulations!", "You have completed all the challenges. Excellent work!", showLevelSelection);
            }
        }

        function updateProgress() {
            const level = levelsData[currentLevelIndex];
            const total = level.questions.length;
            const current = currentQuestionIndex;
            
            progressText.textContent = `Question ${current + 1}/${total}`;
            
            const progressPercentage = total > 0 ? ((current) / total) * 100 : 0;
            progressBar.style.width = `${progressPercentage}%`;
        }

        function showLevelSelection() {
            modal.classList.add('hidden');
            mainView.classList.add('hidden');
            levelSelectionScreen.classList.remove('hidden');
            renderLevelCards(); 
        }

        function showModal(title, text, callback) {
            modalTitle.textContent = title;
            modalText.textContent = text;
            modal.classList.remove('hidden');
            modalBtn.onclick = () => {
                modal.classList.add('hidden');
                if (callback) callback();
            };
        }

        init();
    </script>
</body>
</html>
